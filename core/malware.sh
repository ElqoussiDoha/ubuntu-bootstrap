SAMPLES=/opt/malware/samples
APPS=/opt/malware/apps

install_yara() {
    echo "Installing Yara ..."
    curl -O https://github.com/VirusTotal/yara/archive/v3.4.0.tar.gz
    tar xvf v3.4.0.tar.gz && cd yara-3.4.0
    ./bootstrap.sh
    ./configure
    echo "Installing yara-python ..."
    make && make install
    cd yara-python && python setup.py install
    cd $APPS
}

install_combine() {
    echo "Installing combine ..."
    git clone https://github.com/mlsecproject/combine
    cd combine
    pip install -r requirements.txt
    cd $APPS
}


install_viper() {
    echo "Installing viper ..."
    git clone https://github.com/viper-framework/viper
    cd viper
    sudo apt-get install gcc libssl-dev swig ssdeep
    sudo pip install SQLAlchemy PrettyTable python-magic pydeep
    sudo pip install -r requirements.txt
    
}

install_pev() {
    echo "Installing pev ..."
    sudo apt-get install pev
}


install_py() {
    echo "Installing Python base packages ..."
    sudo apt-get install python-dev python-setuptools python-pip
}

install_packages() {
    echo "Installing additional packages ..."
    sudo apt-get install python-magic pydeep ssdeep hashdeep \
        python-hachoir-core python-hachoir-core python-hachoir-metadata \
        python-hachoir-subfile
    sudo pip install oletools pefile filemagic pyelftools
}

echo "[ Malware analysis setup ]"
echo "Note: Python2.7 and python-pip will be installed to support these applications."
echo " "

echo "Making sample storage directory ($SAMPLES) ..."
mkdir -p $SAMPLES

echo "Making application directory ($APPS) ..."
cd $APPS

install_py
install_packages

install_yara
install_combine
install_pev
install_viper

cd $work